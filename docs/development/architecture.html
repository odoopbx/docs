
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>OdooPBX architecture &#8212; OdooPBX 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nameko.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API" href="api.html" />
    <link rel="prev" title="Developer Guide Introduction" href="index.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Lora:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="api.html" title="API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Developer Guide Introduction"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">OdooPBX 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../development.html" accesskey="U">Development</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">OdooPBX architecture</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="odoopbx-architecture">
<h1>OdooPBX architecture<a class="headerlink" href="#odoopbx-architecture" title="Permalink to this headline">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>As it comes from its name OdooPBX is a PBX platform built upon Odoo &amp; Asterisk.</p>
<p>Odoo (former OpenERP / TinyERP) is a modern WEB business platform that rapidly spreads over the world.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Odoo as a WEB development platform has the following features:</p>
<ul class="simple">
<li><p>A modern architecture with clean separation of layers (MVC).
UI is created in XML, business logic is programmed in Python, data is stored in PostgreSQL and accessed
through ORM (object-relational mapper).</p></li>
<li><p>Rapid application development - Odoo is a blazing fast development tool that allows building new
apps like a lightning.</p></li>
<li><p>Granular security system with row-level colum-level access.</p></li>
<li><p>Safe upgrade framework give a possibility of reliable upgrades.</p></li>
</ul>
</div>
<p>Odoo as a business platform comes with a plenty of ready to use business oriented modules like CRM, Projects, Warehouse,
Sales, Events, etc.</p>
<p>So from one side OdooPBX is a PBX management tool built upon Odoo WEB framework.</p>
<p>From another side OdooPBX adds a telephony layer to existing business modules and by this
integrating tight phone communications with places they happen.</p>
<p>Finally a special middleware Agent is used to connect Odoo and Asterisk together in a proper way.</p>
<p>Let’s dive into the details now.</p>
</section>
<section id="the-agent">
<h2>The Agent<a class="headerlink" href="#the-agent" title="Permalink to this headline">¶</a></h2>
<p>The Agent itself is built upon the Saltstack platform and performs the following functions:</p>
<ul class="simple">
<li><p>Forwards Asterisk events to Odoo according to the downloaded events map.</p></li>
<li><p>Executes Asterisk actions received from Odoo.</p></li>
<li><p>Protects Asterisk from DDoS and password bruteforce attacks.</p></li>
<li><p>Manages the installation &amp; upgrade process.</p></li>
</ul>
<section id="engines">
<h3>Engines<a class="headerlink" href="#engines" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://docs.saltproject.io/en/latest/topics/engines/index.html">Salt Engines</a>
are long-running, external system processes that leverage Salt.</p>
<p>The Agent has the following engines:</p>
<ul class="simple">
<li><p>AMI engine (asterisk_ami);</p></li>
<li><p>Asterisk WEB console engine (asterisk_cli);</p></li>
<li><p>Odoo bus connector engine (odoo_connector);</p></li>
</ul>
<section id="ami-engine">
<h4>AMI engine<a class="headerlink" href="#ami-engine" title="Permalink to this headline">¶</a></h4>
<p>AMI (Asterisk Manager Interface) engine connects to the Asterisk AMI port (usually 5038) and
forwards AMI events to Odoo according to the events map that is downloaded on the Agent startup.</p>
<p>Events map is defined in the Asterisk Common module. Each event has the following structure:</p>
<ul class="simple">
<li><p><strong>name</strong> - AMI event name. Examples: <code class="docutils literal notranslate"><span class="pre">Hangup</span></code>, <code class="docutils literal notranslate"><span class="pre">CDR</span></code>, <code class="docutils literal notranslate"><span class="pre">OriginateResponse</span></code>.</p></li>
<li><p><strong>source</strong> - <code class="docutils literal notranslate"><span class="pre">AMI</span></code> for now.</p></li>
<li><p><strong>model</strong> - Odoo app and model that will receive the event. Example: <code class="docutils literal notranslate"><span class="pre">asterisk_common.user</span></code>.</p></li>
<li><p><strong>method</strong> - model’s method that will be called. Example: <code class="docutils literal notranslate"><span class="pre">ami_originate_response</span></code>.</p></li>
<li><p><strong>condition</strong> - an optional condition evaluated on the Agent side on the event’s data.
Example: <code class="docutils literal notranslate"><span class="pre">event['Response']</span> <span class="pre">==</span> <span class="pre">'Failure'</span></code> (only failure response will be send to Odoo).</p></li>
<li><p><strong>delay</strong> - an optional delay in seconds before sending the event to Odoo. Sometimes it is required to
let previous event to be processed by Odoo. Example: <code class="docutils literal notranslate"><span class="pre">1.5</span></code>.</p></li>
</ul>
</section>
</section>
<section id="modules">
<h3>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h3>
</section>
<section id="states">
<h3>States<a class="headerlink" href="#states" title="Permalink to this headline">¶</a></h3>
</section>
</section>
<section id="odoopbx-modules">
<h2>OdooPBX modules<a class="headerlink" href="#odoopbx-modules" title="Permalink to this headline">¶</a></h2>
<section id="asterisk-base">
<h3>Asterisk Base<a class="headerlink" href="#asterisk-base" title="Permalink to this headline">¶</a></h3>
</section>
<section id="asterisk-calls">
<h3>Asterisk Calls<a class="headerlink" href="#asterisk-calls" title="Permalink to this headline">¶</a></h3>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">OdooPBX architecture</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#the-agent">The Agent</a><ul>
<li><a class="reference internal" href="#engines">Engines</a><ul>
<li><a class="reference internal" href="#ami-engine">AMI engine</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modules">Modules</a></li>
<li><a class="reference internal" href="#states">States</a></li>
</ul>
</li>
<li><a class="reference internal" href="#odoopbx-modules">OdooPBX modules</a><ul>
<li><a class="reference internal" href="#asterisk-base">Asterisk Base</a></li>
<li><a class="reference internal" href="#asterisk-calls">Asterisk Calls</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation index</a><ul>
  <li><a href="../development.html">Development</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Developer Guide Introduction</a></li>
      <li>Next: <a href="api.html" title="next chapter">API</a></li>
  </ul></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/development/architecture.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
  </body>
</html>